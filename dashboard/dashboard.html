<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Agent UM-7 - Classified Operations Dashboard</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ðŸŽ¯</text></svg>">
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #0f172a;
            color: #e2e8f0;
            min-height: 100vh;
        }
        
        .dashboard {
            padding: 24px;
            max-width: 1400px;
            margin: 0 auto;
        }
        
        .header {
            margin-bottom: 32px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2rem;
            color: #3b82f6;
            margin-bottom: 8px;
        }
        
        .header p {
            color: #64748b;
            font-size: 1.1rem;
        }
        
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 32px;
        }
        
        .metric-card {
            background: #1e293b;
            border: 1px solid #334155;
            border-radius: 8px;
            padding: 24px;
            text-align: center;
        }
        
        .metric-value {
            font-size: 2.5rem;
            font-weight: bold;
            margin-bottom: 8px;
        }
        
        .metric-label {
            color: #64748b;
            font-size: 0.875rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        
        .metric-repo {
            color: #475569;
            font-size: 0.75rem;
            margin-top: 4px;
            font-family: 'Courier New', monospace;
        }
        
        .tasks-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 32px;
            margin-bottom: 32px;
        }
        
        .section-card {
            background: #1e293b;
            border: 1px solid #334155;
            border-radius: 8px;
            padding: 24px;
        }
        
        .section-title {
            font-size: 1.5rem;
            margin-bottom: 16px;
            color: #f1f5f9;
        }
        
        .task-item {
            background: #334155;
            border-radius: 6px;
            padding: 16px;
            margin-bottom: 12px;
            border-left: 4px solid;
        }
        
        .task-item.queued { border-left-color: #f59e0b; }
        .task-item.running { border-left-color: #3b82f6; }
        .task-item.passed { border-left-color: #10b981; }
        .task-item.failed { border-left-color: #ef4444; }
        
        .task-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }
        
        .task-title {
            font-weight: 600;
            color: #f1f5f9;
        }
        
        .task-status {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: 500;
            text-transform: uppercase;
        }
        
        .status-queued { background: #f59e0b; color: #000; }
        .status-running { background: #3b82f6; color: #fff; }
        .status-passed { background: #10b981; color: #fff; }
        .status-failed { background: #ef4444; color: #fff; }
        
        .task-meta {
            font-size: 0.875rem;
            color: #94a3b8;
            margin-bottom: 8px;
        }
        
        .task-description {
            font-size: 0.875rem;
            color: #cbd5e1;
        }
        
        .task-progress {
            margin-top: 8px;
            background: #475569;
            border-radius: 4px;
            height: 4px;
            overflow: hidden;
        }
        
        .task-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #3b82f6, #10b981);
            border-radius: 4px;
            transition: width 0.5s ease-in-out;
        }
        
        .task-progress.running .task-progress-bar {
            animation: progress-pulse 2s infinite;
        }
        
        @keyframes progress-pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        
        .agent-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }
        
        .agent-card {
            background: #1e293b;
            border: 1px solid #334155;
            border-radius: 8px;
            padding: 20px;
        }
        
        .agent-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }
        
        .agent-name {
            font-weight: 600;
            color: #f1f5f9;
        }
        
        .agent-status {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-left: auto;
        }
        
        .status-online { background: #10b981; }
        .status-offline { background: #6b7280; }
        .status-busy { background: #f59e0b; }
        
        .provider-list {
            list-style: none;
            font-size: 0.875rem;
            color: #94a3b8;
        }
        
        .provider-list li {
            margin-bottom: 4px;
        }
        
        .refresh-button {
            position: fixed;
            bottom: 24px;
            right: 24px;
            background: #3b82f6;
            color: white;
            border: none;
            border-radius: 50%;
            width: 56px;
            height: 56px;
            font-size: 1.5rem;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
            transition: all 0.2s;
            z-index: 1000;
        }
        
        .refresh-button:hover {
            background: #2563eb;
            transform: scale(1.05);
        }
        
        .submit-task {
            background: #1e293b;
            border: 1px solid #334155;
            border-radius: 8px;
            padding: 24px;
            margin-bottom: 32px;
        }
        
        .form-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
            margin-bottom: 16px;
        }
        
        .form-group {
            display: flex;
            flex-direction: column;
        }
        
        .form-group label {
            color: #f1f5f9;
            font-size: 0.875rem;
            margin-bottom: 8px;
            font-weight: 500;
        }
        
        .form-group input,
        .form-group select,
        .form-group textarea {
            background: #334155;
            border: 1px solid #475569;
            border-radius: 4px;
            padding: 8px 12px;
            color: #f1f5f9;
            font-size: 0.875rem;
        }
        
        .form-group textarea {
            resize: vertical;
            min-height: 100px;
        }
        
        .submit-button {
            background: #10b981;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 12px 24px;
            font-weight: 500;
            cursor: pointer;
            transition: background 0.2s;
        }
        
        .submit-button:hover {
            background: #059669;
        }
        
        .view-toggle {
            display: flex;
            gap: 8px;
        }
        
        .toggle-btn {
            background: #334155;
            border: 1px solid #475569;
            color: #e2e8f0;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 0.875rem;
        }
        
        .toggle-btn:hover {
            background: #475569;
        }
        
        .toggle-btn.active {
            background: #3b82f6;
            border-color: #3b82f6;
            color: white;
        }
        
        .cli-view {
            background: #0f1419;
            border: 1px solid #334155;
            border-radius: 8px;
            padding: 20px;
            font-family: 'Fira Code', 'Monaco', 'Consolas', monospace;
            color: #e2e8f0;
        }
        
        .cli-header {
            color: #10b981;
            margin-bottom: 20px;
            font-size: 1.1rem;
            border-bottom: 1px solid #334155;
            padding-bottom: 10px;
        }
        
        .cli-commands {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 16px;
            margin-bottom: 24px;
        }
        
        .cli-command {
            background: #1e293b;
            border: 1px solid #334155;
            border-radius: 6px;
            padding: 12px;
        }
        
        .cli-command-title {
            color: #f59e0b;
            font-weight: bold;
            margin-bottom: 8px;
        }
        
        .cli-command-code {
            color: #94a3b8;
            font-size: 0.875rem;
            word-break: break-all;
        }
        
        .specs-section {
            background: #1e293b;
            border: 1px solid #334155;
            border-radius: 8px;
            padding: 24px;
            margin-bottom: 32px;
        }
        
        .specs-grid {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 24px;
        }
        
        .spec-list {
            max-height: 400px;
            overflow-y: auto;
        }
        
        .spec-item {
            background: #334155;
            border: 1px solid #475569;
            border-radius: 6px;
            padding: 12px;
            margin-bottom: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .spec-item:hover {
            background: #475569;
            border-color: #64748b;
        }
        
        .spec-item.selected {
            background: #3b82f6;
            border-color: #2563eb;
        }
        
        .spec-title {
            font-weight: 600;
            color: #f1f5f9;
            margin-bottom: 4px;
        }
        
        .spec-summary {
            font-size: 0.875rem;
            color: #94a3b8;
        }
        
        .spec-content {
            background: #0f172a;
            border: 1px solid #334155;
            border-radius: 6px;
            padding: 16px;
            max-height: 400px;
            overflow-y: auto;
            font-family: 'Fira Code', 'Monaco', 'Consolas', monospace;
            font-size: 0.875rem;
            line-height: 1.5;
            white-space: pre-wrap;
        }
        
        .spec-phases {
            margin: 16px 0;
        }
        
        .phase-item {
            background: #1e293b;
            border-left: 3px solid #3b82f6;
            border-radius: 4px;
            padding: 8px 12px;
            margin-bottom: 8px;
        }
        
        .phase-title {
            font-weight: 600;
            color: #3b82f6;
            font-size: 0.875rem;
        }
        
        .phase-details {
            color: #94a3b8;
            font-size: 0.75rem;
            margin-top: 4px;
        }
        
        .responsibilities-list {
            margin: 16px 0;
        }
        
        .responsibility-item {
            background: #334155;
            border-radius: 4px;
            padding: 6px 10px;
            margin-bottom: 4px;
            font-size: 0.75rem;
            color: #cbd5e1;
        }
        
        .spec-meta {
            display: flex;
            gap: 12px;
            margin-bottom: 12px;
            font-size: 0.75rem;
            color: #64748b;
        }
        
        .spec-tab {
            background: #334155;
            border: 1px solid #475569;
            border-radius: 4px;
            padding: 6px 12px;
            cursor: pointer;
            font-size: 0.75rem;
            transition: all 0.2s;
        }
        
        .spec-tab:hover {
            background: #475569;
        }
        
        .spec-tab.active {
            background: #3b82f6;
            border-color: #2563eb;
            color: white;
        }
        
        /* Mode toggle styles */
        .mode-toggle {
            background: #1e293b;
            border: 1px solid #334155;
            border-radius: 8px;
            padding: 4px;
            display: flex;
            gap: 2px;
            margin-right: 16px;
        }
        
        .mode-option {
            background: transparent;
            border: none;
            color: #94a3b8;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.875rem;
            font-weight: 500;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .mode-option:hover {
            background: #334155;
            color: #e2e8f0;
        }
        
        .mode-option.active {
            background: #3b82f6;
            color: white;
            box-shadow: 0 2px 4px rgba(59, 130, 246, 0.3);
        }
        
        /* Model selector styles */
        .model-selector {
            position: relative;
            display: inline-block;
        }
        
        .model-select {
            background: #1e293b;
            border: 1px solid #334155;
            color: #e2e8f0;
            padding: 8px 32px 8px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.875rem;
            appearance: none;
            min-width: 160px;
        }
        
        .model-select:hover {
            background: #334155;
            border-color: #475569;
        }
        
        .model-select:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.2);
        }
        
        .model-selector::after {
            content: 'â–¼';
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: #64748b;
            pointer-events: none;
            font-size: 0.75rem;
        }
        
        .model-status {
            font-size: 0.75rem;
            color: #10b981;
            margin-left: 8px;
            display: flex;
            align-items: center;
            gap: 4px;
        }
        
        .mode-indicator {
            font-size: 0.75rem;
            color: #64748b;
            margin-left: 8px;
            display: flex;
            align-items: center;
            gap: 4px;
        }
        
        /* Real CLI Terminal interface styles */
        .cli-terminal-container {
            background: #0f1419;
            border: 1px solid #334155;
            border-radius: 8px;
            height: 600px;
            display: flex;
            flex-direction: column;
            font-family: 'Fira Code', 'Monaco', 'Consolas', monospace;
            position: relative;
        }
        
        .cli-terminal-header {
            background: #1e293b;
            border-bottom: 1px solid #334155;
            padding: 12px 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-radius: 8px 8px 0 0;
        }
        
        .cli-session-tabs {
            display: flex;
            gap: 4px;
            background: #0f172a;
            padding: 8px 16px;
            border-bottom: 1px solid #334155;
            overflow-x: auto;
        }
        
        .cli-session-tab {
            background: #1e293b;
            border: 1px solid #334155;
            border-radius: 6px 6px 0 0;
            padding: 6px 12px;
            cursor: pointer;
            font-size: 0.75rem;
            display: flex;
            align-items: center;
            gap: 6px;
            transition: all 0.2s;
            white-space: nowrap;
        }
        
        .cli-session-tab:hover {
            background: #334155;
        }
        
        .cli-session-tab.active {
            background: #3b82f6;
            border-color: #2563eb;
            color: white;
        }
        
        .cli-session-close {
            background: none;
            border: none;
            color: #94a3b8;
            cursor: pointer;
            padding: 0;
            width: 16px;
            height: 16px;
            border-radius: 2px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
        }
        
        .cli-session-close:hover {
            background: #ef4444;
            color: white;
        }
        
        .cli-status-indicators {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 0.75rem;
        }
        
        .cli-status-indicator {
            display: flex;
            align-items: center;
            gap: 4px;
            padding: 4px 8px;
            border-radius: 4px;
            background: #334155;
        }
        
        .cli-status-dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
        }
        
        .status-initializing .cli-status-dot { background: #64748b; }
        .status-starting .cli-status-dot { background: #f59e0b; animation: pulse 1.5s infinite; }
        .status-running .cli-status-dot { background: #10b981; }
        .status-waiting_input .cli-status-dot { background: #8b5cf6; animation: pulse 1.5s infinite; }
        .status-processing .cli-status-dot { background: #3b82f6; animation: pulse 1.5s infinite; }
        .status-error .cli-status-dot { background: #ef4444; }
        .status-terminated .cli-status-dot { background: #6b7280; }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .cli-connection-status {
            font-size: 0.75rem;
            padding: 4px 8px;
            border-radius: 4px;
            background: #1e293b;
        }
        
        .connection-connected { color: #10b981; }
        .connection-connecting { color: #f59e0b; }
        .connection-disconnected { color: #ef4444; }
        
        .terminal-container {
            background: #0f1419;
            border: 1px solid #334155;
            border-radius: 8px;
            height: 500px;
            display: flex;
            flex-direction: column;
            font-family: 'Fira Code', 'Monaco', 'Consolas', monospace;
        }
        
        .terminal-header {
            background: #1e293b;
            border-bottom: 1px solid #334155;
            padding: 12px 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-radius: 8px 8px 0 0;
        }
        
        .terminal-title {
            color: #e2e8f0;
            font-size: 0.875rem;
            font-weight: 500;
        }
        
        .terminal-controls {
            display: flex;
            gap: 6px;
        }
        
        .terminal-control {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            cursor: pointer;
        }
        
        .terminal-control.close { background: #ef4444; }
        .terminal-control.minimize { background: #f59e0b; }
        .terminal-control.maximize { background: #10b981; }
        
        .cli-terminal-output {
            flex: 1;
            padding: 16px;
            overflow-y: auto;
            color: #e2e8f0;
            font-size: 0.875rem;
            line-height: 1.6;
            position: relative;
        }
        
        .cli-output-line {
            margin-bottom: 2px;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        
        .cli-output-stdout { color: #e2e8f0; }
        .cli-output-stderr { color: #ef4444; }
        .cli-output-system { color: #64748b; font-style: italic; }
        .cli-output-auth { color: #8b5cf6; background: #1e293b; padding: 4px 8px; border-radius: 4px; }
        
        .cli-auth-prompt {
            background: #8b5cf6;
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            margin: 8px 0;
            display: flex;
            align-items: center;
            gap: 8px;
            animation: glow 2s infinite;
        }
        
        @keyframes glow {
            0%, 100% { box-shadow: 0 0 5px rgba(139, 92, 246, 0.3); }
            50% { box-shadow: 0 0 20px rgba(139, 92, 246, 0.6); }
        }
        
        .cli-process-status {
            position: absolute;
            top: 8px;
            right: 8px;
            background: rgba(15, 23, 42, 0.9);
            border: 1px solid #334155;
            border-radius: 4px;
            padding: 4px 8px;
            font-size: 0.75rem;
            display: flex;
            align-items: center;
            gap: 4px;
        }
        
        .terminal-output {
            flex: 1;
            padding: 16px;
            overflow-y: auto;
            color: #e2e8f0;
            font-size: 0.875rem;
            line-height: 1.6;
        }
        
        .terminal-output::-webkit-scrollbar {
            width: 6px;
        }
        
        .terminal-output::-webkit-scrollbar-track {
            background: #0f1419;
        }
        
        .terminal-output::-webkit-scrollbar-thumb {
            background: #334155;
            border-radius: 3px;
        }
        
        .terminal-prompt {
            color: #10b981;
            margin-right: 8px;
        }
        
        .terminal-command {
            color: #e2e8f0;
        }
        
        .terminal-result {
            color: #94a3b8;
            margin: 8px 0 16px 0;
            padding-left: 16px;
            border-left: 2px solid #334155;
        }
        
        .terminal-error {
            color: #ef4444;
            margin: 8px 0 16px 0;
            padding-left: 16px;
            border-left: 2px solid #ef4444;
        }
        
        .terminal-success {
            color: #10b981;
            margin: 8px 0 16px 0;
            padding-left: 16px;
            border-left: 2px solid #10b981;
        }
        
        .cli-terminal-input-container {
            background: #1e293b;
            border-top: 1px solid #334155;
            padding: 12px 16px;
            display: flex;
            align-items: center;
            border-radius: 0 0 8px 8px;
            position: relative;
        }
        
        .cli-terminal-input {
            background: transparent;
            border: none;
            color: #e2e8f0;
            font-family: inherit;
            font-size: 0.875rem;
            width: 100%;
            outline: none;
        }
        
        .cli-terminal-input::placeholder {
            color: #64748b;
        }
        
        .cli-terminal-input:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .cli-input-actions {
            display: flex;
            gap: 8px;
            margin-left: 8px;
        }
        
        .cli-input-action {
            background: #334155;
            border: 1px solid #475569;
            color: #e2e8f0;
            padding: 4px 8px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.75rem;
            transition: all 0.2s;
        }
        
        .cli-input-action:hover {
            background: #475569;
        }
        
        .cli-input-action:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .cli-session-controls {
            display: flex;
            gap: 8px;
            align-items: center;
        }
        
        .cli-new-session-btn {
            background: #10b981;
            border: none;
            color: white;
            padding: 6px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.75rem;
            font-weight: 500;
            transition: background 0.2s;
        }
        
        .cli-new-session-btn:hover {
            background: #059669;
        }
        
        .terminal-input-container {
            background: #1e293b;
            border-top: 1px solid #334155;
            padding: 12px 16px;
            display: flex;
            align-items: center;
            border-radius: 0 0 8px 8px;
        }
        
        .terminal-input {
            background: transparent;
            border: none;
            color: #e2e8f0;
            font-family: inherit;
            font-size: 0.875rem;
            width: 100%;
            outline: none;
        }
        
        .terminal-input::placeholder {
            color: #64748b;
        }
        
        .command-history {
            background: #1e293b;
            border: 1px solid #334155;
            border-radius: 6px;
            max-height: 200px;
            overflow-y: auto;
            position: absolute;
            bottom: 100%;
            left: 0;
            right: 0;
            z-index: 10;
            display: none;
        }
        
        .command-history.show {
            display: block;
        }
        
        .history-item {
            padding: 8px 16px;
            cursor: pointer;
            color: #94a3b8;
            font-size: 0.875rem;
            border-bottom: 1px solid #334155;
        }
        
        .history-item:hover {
            background: #334155;
            color: #e2e8f0;
        }
        
        .history-item:last-child {
            border-bottom: none;
        }
        
        .quick-commands {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 12px;
            margin-bottom: 20px;
        }
        
        .quick-command {
            background: #1e293b;
            border: 1px solid #334155;
            border-radius: 6px;
            padding: 8px 12px;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 0.875rem;
        }
        
        .quick-command:hover {
            background: #334155;
            border-color: #3b82f6;
        }
        
        .quick-command-title {
            color: #3b82f6;
            font-weight: 500;
            margin-bottom: 4px;
        }
        
        .quick-command-desc {
            color: #94a3b8;
            font-size: 0.75rem;
        }
        
    </style>
</head>
<body>
    <div id="dashboard-root"></div>

    <script type="text/babel" data-presets="env,react">
        const { useState, useEffect } = React;

        // Mock data for demonstration - would be replaced with API calls
        const mockMetrics = {
            repository: {
                name: "um-agent-orchestration",
                path: "/home/umwai/um-agent-orchestration", 
                branch: "main"
            },
            tasksEnqueued: 142,
            tasksRunning: 3,
            tasksPassed: 128,
            tasksFailed: 11,
            commitsMade: 89,
            prsOpened: 23,
            prsQueued: 5,
            conflictsDetected: 2
        };

        const mockMergeQueue = {
            active_merge: "PR-123",
            queue: [
                { pr_id: "124", branch: "auto/backend/auth-fix", priority: "BUG", status: "queued", conflicts: [] },
                { pr_id: "125", branch: "auto/frontend/dashboard", priority: "FEATURE", status: "queued", conflicts: [] },
                { pr_id: "126", branch: "auto/data/analytics", priority: "SECURITY", status: "conflict", conflicts: ["src/auth.py", "config/settings.py"] }
            ],
            queue_length: 3
        };

        const mockTasks = [
            {
                id: "task-1",
                title: "Implement user authentication API",
                description: "Add JWT-based authentication with role-based access control",
                role: "backend",
                status: "running",
                branch: "feat/backend/auth-api",
                createdAt: "2025-08-26T10:30:00Z"
            },
            {
                id: "task-2", 
                title: "Create React dashboard components",
                description: "Build responsive dashboard with real-time updates",
                role: "frontend",
                status: "queued",
                branch: "feat/frontend/dashboard",
                createdAt: "2025-08-26T11:15:00Z"
            },
            {
                id: "task-3",
                title: "Optimize database queries",
                description: "Add indexes and optimize slow queries in user analytics",
                role: "data",
                status: "passed",
                branch: "feat/data/query-optimization", 
                createdAt: "2025-08-26T09:45:00Z"
            },
            {
                id: "task-4",
                title: "Deploy ML model pipeline",
                description: "Set up automated training and deployment for recommendation model",
                role: "ml",
                status: "failed",
                branch: "feat/ml/recommendation-pipeline",
                createdAt: "2025-08-26T08:20:00Z",
                error: "Model validation failed - accuracy below threshold"
            }
        ];

        const mockAgents = [
            {
                name: "Claude Interactive",
                status: "busy",
                provider: "claude_interactive",
                currentTask: "task-1",
                capabilities: ["Full Access", "Code Generation", "File Operations"]
            },
            {
                name: "Codex CLI",
                status: "online", 
                provider: "codex_cli",
                currentTask: null,
                capabilities: ["Code Generation", "Testing", "Debugging"]
            },
            {
                name: "Gemini CLI",
                status: "online",
                provider: "gemini_cli", 
                currentTask: null,
                capabilities: ["Analysis", "Documentation", "Optimization"]
            },
            {
                name: "Backend Agent",
                status: "busy",
                provider: "anthropic_api",
                currentTask: "task-1",
                capabilities: ["FastAPI", "Database", "Testing"]
            }
        ];

        function Dashboard() {
            const [metrics, setMetrics] = useState(mockMetrics);
            const [tasks, setTasks] = useState([]);
            const [agents, setAgents] = useState([]);
            const [mergeQueue, setMergeQueue] = useState({currently_merging: null, queue: [], queue_length: 0});
            const [repositories, setRepositories] = useState([]);
            const [newTask, setNewTask] = useState({
                title: '',
                description: '',
                role: 'generic',
                repositoryUrl: '',
                baseBranch: '',
                fullAccess: false
            });
            const [availableBranches, setAvailableBranches] = useState([]);
            const [repositorySpecs, setRepositorySpecs] = useState([]);
            const [selectedSpec, setSelectedSpec] = useState(null);
            const [specViewMode, setSpecViewMode] = useState('summary'); // 'summary' | 'phases' | 'content'
            const [isSubmitting, setIsSubmitting] = useState(false);
            const [submitError, setSubmitError] = useState(null);
            const [submitSuccess, setSubmitSuccess] = useState(false);
            const [websocket, setWebsocket] = useState(null);
            const [connectionStatus, setConnectionStatus] = useState('disconnected');
            const [selectedModel, setSelectedModel] = useState('claude');
            const [modelMode, setModelMode] = useState('cli'); // 'cli' or 'api'
            
            // Real CLI session states
            const [cliSessions, setCliSessions] = useState({});
            const [activeSessionId, setActiveSessionId] = useState(null);
            const [cliWebsockets, setCliWebsockets] = useState({});
            const [cliProviders, setCliProviders] = useState({});

            // Fetch available CLI providers
            const fetchCliProviders = async () => {
                try {
                    const response = await fetch('/api/cli/providers');
                    if (response.ok) {
                        const data = await response.json();
                        setCliProviders(data.providers);
                        
                        // Auto-select first available provider
                        const availableProviders = Object.keys(data.providers)
                            .filter(key => data.providers[key].available);
                        if (availableProviders.length > 0 && modelMode === 'cli') {
                            setSelectedModel(availableProviders[0]);
                        }
                    }
                } catch (error) {
                    console.error('Error fetching CLI providers:', error);
                }
            };
            
            // CLI session management functions
            const createCliSession = async (cliTool, fullAccess = false) => {
                try {
                    const response = await fetch('/api/cli/sessions', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            cli_tool: cliTool,
                            mode: fullAccess ? 'interactive' : 'cli',
                            full_access: fullAccess,
                            cwd: metrics.repository?.path
                        })
                    });
                    
                    if (response.ok) {
                        const sessionData = await response.json();
                        const sessionId = sessionData.session_id;
                        
                        // Initialize session state
                        const newSession = {
                            id: sessionId,
                            cli_tool: cliTool,
                            mode: sessionData.mode,
                            state: sessionData.state,
                            output: [{
                                type: 'system',
                                content: `Starting ${cliTool} CLI session...`,
                                timestamp: Date.now()
                            }],
                            input: '',
                            connectionStatus: 'connecting',
                            fullAccess: fullAccess,
                            authRequired: false
                        };
                        
                        setCliSessions(prev => ({...prev, [sessionId]: newSession}));
                        setActiveSessionId(sessionId);
                        
                        // Connect WebSocket
                        connectCliWebSocket(sessionId);
                        
                        return sessionId;
                    }
                } catch (error) {
                    console.error('Failed to create CLI session:', error);
                }
                return null;
            };
            
            const connectCliWebSocket = (sessionId) => {
                const protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';
                // Add token as query parameter for authentication if needed
                const token = localStorage.getItem('cli_auth_token') || '';
                const wsUrl = `${protocol}//${window.location.host}/ws/cli/${sessionId}${token ? `?token=${encodeURIComponent(token)}` : ''}`;
                
                const ws = new WebSocket(wsUrl);
                
                ws.onopen = () => {
                    console.log(`CLI WebSocket connected for session ${sessionId}`);
                    setCliSessions(prev => ({
                        ...prev,
                        [sessionId]: {
                            ...prev[sessionId],
                            connectionStatus: 'connected'
                        }
                    }));
                };
                
                ws.onmessage = (event) => {
                    try {
                        const msg = JSON.parse(event.data);
                        const payload = msg.data || {};

                        if (msg.type === 'output') {
                            const outputType = payload.output_type || 'stdout';
                            const content = payload.content ?? payload.output ?? '';
                            const ts = payload.timestamp || Date.now();

                            setCliSessions(prev => ({
                                ...prev,
                                [sessionId]: {
                                    ...prev[sessionId],
                                    output: [...(prev[sessionId]?.output || []), {
                                        type: outputType,
                                        content,
                                        timestamp: ts
                                    }]
                                }
                            }));
                        } else if (msg.type === 'status') {
                            // Handle both legacy {session: {...}} and new {data: {...}} formats
                            const sessionInfo = payload.session || payload;
                            setCliSessions(prev => ({
                                ...prev,
                                [sessionId]: {
                                    ...prev[sessionId],
                                    state: sessionInfo.state ?? prev[sessionId]?.state,
                                    authRequired: sessionInfo.authentication_required ?? prev[sessionId]?.authRequired,
                                    authPrompt: sessionInfo.auth_prompt ?? prev[sessionId]?.authPrompt,
                                    pid: sessionInfo.pid ?? prev[sessionId]?.pid,
                                    connectionStatus: prev[sessionId]?.connectionStatus || 'connected'
                                }
                            }));
                        }
                    } catch (error) {
                        console.error('Error parsing CLI WebSocket message:', error);
                    }
                };
                
                ws.onclose = () => {
                    console.log(`CLI WebSocket disconnected for session ${sessionId}`);
                    setCliSessions(prev => ({
                        ...prev,
                        [sessionId]: {
                            ...prev[sessionId],
                            connectionStatus: 'disconnected'
                        }
                    }));
                };
                
                ws.onerror = (error) => {
                    console.error(`CLI WebSocket error for session ${sessionId}:`, error);
                    setCliSessions(prev => ({
                        ...prev,
                        [sessionId]: {
                            ...prev[sessionId],
                            connectionStatus: 'error'
                        }
                    }));
                };
                
                setCliWebsockets(prev => ({...prev, [sessionId]: ws}));
            };
            
            const sendCliInput = (sessionId, input, inputType = 'command') => {
                const ws = cliWebsockets[sessionId];
                if (ws && ws.readyState === WebSocket.OPEN) {
                    const message = {
                        type: inputType,
                        session_id: sessionId,
                        data: {
                            command: input
                        },
                        timestamp: new Date().toISOString()
                    };
                    
                    ws.send(JSON.stringify(message));
                    
                    // Add input to display
                    setCliSessions(prev => ({
                        ...prev,
                        [sessionId]: {
                            ...prev[sessionId],
                            output: [...(prev[sessionId]?.output || []), {
                                type: 'command',
                                content: input,
                                timestamp: Date.now()
                            }],
                            input: ''
                        }
                    }));
                }
            };
            
            const terminateCliSession = async (sessionId) => {
                try {
                    // Close WebSocket
                    const ws = cliWebsockets[sessionId];
                    if (ws) {
                        ws.close();
                    }
                    
                    // Terminate on server
                    await fetch(`/api/cli/sessions/${sessionId}/terminate`, {
                        method: 'POST'
                    });
                    
                    // Remove from state
                    setCliSessions(prev => {
                        const newSessions = {...prev};
                        delete newSessions[sessionId];
                        return newSessions;
                    });
                    
                    setCliWebsockets(prev => {
                        const newWebsockets = {...prev};
                        delete newWebsockets[sessionId];
                        return newWebsockets;
                    });
                    
                    // Switch to another session or none
                    if (activeSessionId === sessionId) {
                        const remainingSessions = Object.keys(cliSessions).filter(id => id !== sessionId);
                        setActiveSessionId(remainingSessions.length > 0 ? remainingSessions[0] : null);
                    }
                    
                } catch (error) {
                    console.error('Failed to terminate CLI session:', error);
                }
            };
            

            // Fetch real data from APIs
            const fetchMetrics = async () => {
                try {
                    const response = await fetch('/api/metrics');
                    if (response.ok) {
                        const data = await response.json();
                        // Map API response to dashboard format
                        setMetrics({
                            repository: data.repository || mockMetrics.repository,
                            tasksEnqueued: data.tasks_enqueued || 0,
                            tasksRunning: data.tasks_started || 0,
                            tasksPassed: data.tasks_succeeded || 0,
                            tasksFailed: data.tasks_failed || 0,
                            commitsMade: data.commits_made || 0,
                            prsOpened: data.prs_opened || 0,
                            prsQueued: data.prs_queued || 0,
                            conflictsDetected: data.conflicts_detected || 0
                        });
                    }
                } catch (error) {
                    console.log('Using mock data, API not available:', error);
                }
            };

            const fetchTasks = async () => {
                try {
                    const response = await fetch('/tasks');
                    if (response.ok) {
                        const data = await response.json();
                        setTasks(data);
                    }
                } catch (error) {
                    console.log('Could not fetch tasks:', error);
                }
            };

            const fetchAgents = async () => {
                try {
                    const response = await fetch('/agents/status');
                    if (response.ok) {
                        const data = await response.json();
                        setAgents(data);
                    }
                } catch (error) {
                    console.log('Could not fetch agent status:', error);
                }
            };

            const fetchMergeQueue = async () => {
                try {
                    const response = await fetch('/merge/status');
                    if (response.ok) {
                        const data = await response.json();
                        setMergeQueue(data);
                    }
                } catch (error) {
                    console.log('Could not fetch merge queue:', error);
                }
            };

            // Fetch available repositories
            const fetchRepositories = async () => {
                try {
                    const response = await fetch('/api/repositories');
                    if (response.ok) {
                        const data = await response.json();
                        setRepositories(data.repositories);
                    }
                } catch (error) {
                    console.log('Could not fetch repositories:', error);
                }
            };

            // Fetch branches for selected repository
            const fetchBranches = async (repoName) => {
                if (!repoName) {
                    repoName = 'um-agent-orchestration';
                }
                try {
                    const response = await fetch(`/api/repositories/${repoName}/branches`);
                    if (response.ok) {
                        const data = await response.json();
                        setAvailableBranches(data.branches || []);
                    }
                } catch (error) {
                    console.log('Could not fetch branches:', error);
                    setAvailableBranches([]);
                }
            };

            // Fetch specs for selected repository
            const fetchSpecs = async (repoName) => {
                if (!repoName) {
                    repoName = 'um-agent-orchestration';
                }
                try {
                    const response = await fetch(`/api/repositories/${repoName}/specs`);
                    if (response.ok) {
                        const data = await response.json();
                        setRepositorySpecs(data.specs || []);
                    }
                } catch (error) {
                    console.log('Could not fetch specs:', error);
                    setRepositorySpecs([]);
                }
            };

            // Handle repository selection change
            const handleRepositoryChange = (repositoryUrl) => {
                setNewTask({...newTask, repositoryUrl, baseBranch: ''});
                setSelectedSpec(null);
                setRepositorySpecs([]);
                if (repositoryUrl) {
                    const repoName = repositoryUrl.split('/').pop();
                    fetchBranches(repoName);
                    fetchSpecs(repoName);
                } else {
                    fetchBranches('um-agent-orchestration');
                    fetchSpecs('um-agent-orchestration');
                }
            };

            // Handle spec selection
            const handleSpecSelect = (spec) => {
                setSelectedSpec(spec);
                // Auto-populate task title from spec if empty
                if (!newTask.title) {
                    setNewTask({...newTask, title: `Implement: ${spec.title}`});
                }
            };

            // Initialize WebSocket connection
            const initWebSocket = () => {
                try {
                    const ws = new WebSocket(`ws://localhost:8001/ws`);
                    
                    ws.onopen = () => {
                        console.log('WebSocket connected');
                        setConnectionStatus('connected');
                        setWebsocket(ws);
                    };
                    
                    ws.onmessage = (event) => {
                        try {
                            const data = JSON.parse(event.data);
                            if (data.type === 'task_submitted') {
                                fetchTasks();
                                fetchMetrics();
                            } else if (data.type === 'merge_queue_update') {
                                fetchMergeQueue();
                            }
                        } catch (e) {
                            console.log('WebSocket message:', event.data);
                        }
                    };
                    
                    ws.onclose = () => {
                        console.log('WebSocket disconnected');
                        setConnectionStatus('disconnected');
                        setWebsocket(null);
                        // Attempt to reconnect after 5 seconds
                        setTimeout(initWebSocket, 5000);
                    };
                    
                    ws.onerror = (error) => {
                        console.error('WebSocket error:', error);
                        setConnectionStatus('error');
                    };
                } catch (error) {
                    console.error('Failed to initialize WebSocket:', error);
                    setConnectionStatus('error');
                }
            };

            // Load data on mount and set up refresh interval
            React.useEffect(() => {
                fetchMetrics();
                fetchTasks();
                fetchAgents();
                fetchMergeQueue();
                fetchRepositories();
                fetchBranches('um-agent-orchestration'); // Load branches for current repo
                fetchSpecs('um-agent-orchestration'); // Load specs for current repo
                fetchCliProviders(); // Load available CLI providers
                
                // Initialize WebSocket for real-time updates
                initWebSocket();
                
                const interval = setInterval(() => {
                    fetchMetrics();
                    fetchTasks();
                    fetchAgents();
                    fetchMergeQueue();
                }, 30000); // Refresh every 30s
                
                return () => {
                    clearInterval(interval);
                    if (websocket) {
                        websocket.close();
                    }
                };
            }, []);

            const handleSubmitTask = async (e) => {
                e.preventDefault();
                setIsSubmitting(true);
                setSubmitError(null);
                setSubmitSuccess(false);
                
                try {
                    const taskSpec = {
                        id: `task-${Date.now()}`,
                        title: newTask.title,
                        description: newTask.description,
                        role: newTask.role,
                        full_access: newTask.fullAccess,
                        repository_url: newTask.repositoryUrl || null,
                        base_branch: newTask.baseBranch || null
                    };
                    
                    const response = await fetch('/tasks', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(taskSpec)
                    });
                    
                    if (response.ok) {
                        const result = await response.json();
                        console.log('Task submitted:', result);
                        setSubmitSuccess(true);
                        // Reset form
                        setNewTask({ title: '', description: '', role: 'generic', repositoryUrl: '', baseBranch: '', fullAccess: false });
                        // Refresh data to show updated counts and new task
                        fetchMetrics();
                        fetchTasks();
                        // Clear success message after 3 seconds
                        setTimeout(() => setSubmitSuccess(false), 3000);
                    } else {
                        const errorData = await response.json().catch(() => ({}));
                        setSubmitError(`Failed to submit task: ${errorData.detail || 'Unknown error'}`);
                    }
                } catch (error) {
                    setSubmitError(`Network error: ${error.message}`);
                } finally {
                    setIsSubmitting(false);
                }
            };

            const refreshData = () => {
                fetchMetrics();
                fetchTasks();
                fetchAgents();
                fetchMergeQueue();
                console.log('Refreshing dashboard data...');
            };
            
            
            // Auto-scroll real CLI output
            React.useEffect(() => {
                const cliOutput = document.querySelector('.cli-terminal-output');
                if (cliOutput) {
                    cliOutput.scrollTop = cliOutput.scrollHeight;
                }
            }, [cliSessions, activeSessionId]);
            
            // Clean up WebSocket connections on unmount
            React.useEffect(() => {
                return () => {
                    Object.values(cliWebsockets).forEach(ws => {
                        if (ws && ws.readyState === WebSocket.OPEN) {
                            ws.close();
                        }
                    });
                };
            }, []);

            const runningTasks = tasks.filter(t => t.status === 'running' || t.status === 'queued');
            const completedTasks = tasks.filter(t => t.status === 'passed' || t.status === 'failed');

            return (
                <div className="dashboard">
                    <div className="header">
                        <div style={{display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start'}}>
                            <div>
                                <h1>ðŸŽ¯ Agent UM-7</h1>
                                <p>Underground Mission Unit 7 â€¢ Classified Operations Dashboard</p>
                                <div style={{marginTop: '12px', fontSize: '0.875rem', color: '#94a3b8'}}>
                                    ðŸ“ Repository: <span style={{color: '#3b82f6'}}>{metrics.repository?.name || 'unknown'}</span> â€¢ 
                                    ðŸŒ¿ Branch: <span style={{color: '#10b981'}}>{metrics.repository?.branch || 'unknown'}</span> â€¢
                                    <span style={{color: connectionStatus === 'connected' ? '#10b981' : '#ef4444'}}>
                                        {connectionStatus === 'connected' ? 'ðŸŸ¢ Live' : connectionStatus === 'error' ? 'ðŸ”´ Error' : 'ðŸŸ¡ Connecting...'}
                                    </span>
                                </div>
                            </div>
                            <div style={{display: 'flex', alignItems: 'center', gap: '16px'}}>
                                <div className="mode-toggle">
                                    <button 
                                        className={`mode-option ${modelMode === 'cli' ? 'active' : ''}`}
                                        onClick={() => {
                                            setModelMode('cli');
                                            setSelectedModel('claude');
                                        }}
                                    >
                                        ðŸ’» CLI
                                    </button>
                                    <button 
                                        className={`mode-option ${modelMode === 'api' ? 'active' : ''}`}
                                        onClick={() => {
                                            setModelMode('api');
                                            setSelectedModel('gpt-5');
                                        }}
                                    >
                                        â˜ï¸ API
                                    </button>
                                </div>
                                <div className="model-selector">
                                    <select 
                                        className="model-select" 
                                        value={selectedModel} 
                                        onChange={(e) => setSelectedModel(e.target.value)}
                                    >
                                        {modelMode === 'cli' ? (
                                            <React.Fragment>
                                                {Object.entries(cliProviders).map(([key, provider]) => (
                                                    <option 
                                                        key={key} 
                                                        value={key} 
                                                        disabled={!provider.available}
                                                    >
                                                        {provider.available ? 'âœ…' : 'âŒ'} {provider.name} CLI
                                                    </option>
                                                ))}
                                            </React.Fragment>
                                        ) : (
                                            <React.Fragment>
                                                <option value="gpt-5">ðŸ§  GPT-5</option>
                                                <option value="claude-sonnet-4">ðŸ¤– Claude Sonnet 4</option>
                                                <option value="gpt-4o">ðŸ§  GPT-4o</option>
                                                <option value="gemini-pro-2.0">ðŸ’Ž Gemini Pro 2.0</option>
                                            </React.Fragment>
                                        )}
                                    </select>
                                    <span className="model-status">
                                        {modelMode === 'cli' && cliProviders[selectedModel] ? (
                                            cliProviders[selectedModel].available ? 'âœ… Available' : 'âŒ Not Installed'
                                        ) : (
                                            'â— Active'
                                        )}
                                    </span>
                                    <span className="mode-indicator">
                                        {modelMode === 'cli' ? 'ðŸ’» Local' : 'â˜ï¸ Cloud'}
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div className="metrics-grid">
                        <div className="metric-card">
                            <div className="metric-value" style={{color: '#3b82f6'}}>{metrics.tasksRunning}</div>
                            <div className="metric-label">Currently Running</div>
                            <div className="metric-repo">{metrics.repository?.name || 'unknown'}</div>
                        </div>
                        <div className="metric-card">
                            <div className="metric-value" style={{color: '#f59e0b'}}>{metrics.tasksEnqueued}</div>
                            <div className="metric-label">Total Enqueued</div>
                            <div className="metric-repo">{metrics.repository?.name || 'unknown'}</div>
                        </div>
                        <div className="metric-card">
                            <div className="metric-value" style={{color: '#10b981'}}>{metrics.tasksPassed}</div>
                            <div className="metric-label">Completed Successfully</div>
                            <div className="metric-repo">{metrics.repository?.name || 'unknown'}</div>
                        </div>
                        <div className="metric-card">
                            <div className="metric-value" style={{color: '#ef4444'}}>{metrics.tasksFailed}</div>
                            <div className="metric-label">Failed Tasks</div>
                            <div className="metric-repo">{metrics.repository?.name || 'unknown'}</div>
                        </div>
                    </div>

                    <div className="submit-task">
                        <h2 className="section-title">Submit New Task</h2>
                        <form onSubmit={handleSubmitTask}>
                            <div className="form-grid">
                                <div className="form-group">
                                    <label>Task Title</label>
                                    <input
                                        type="text"
                                        value={newTask.title}
                                        onChange={(e) => setNewTask({...newTask, title: e.target.value})}
                                        placeholder="Brief task description"
                                        required
                                    />
                                </div>
                                <div className="form-group">
                                    <label>Agent Role</label>
                                    <select
                                        value={newTask.role}
                                        onChange={(e) => setNewTask({...newTask, role: e.target.value})}
                                    >
                                        <option value="generic">Generic</option>
                                        <option value="backend">Backend</option>
                                        <option value="frontend">Frontend</option>
                                        <option value="data">Data/ML</option>
                                    </select>
                                </div>
                            </div>
                            <div className="form-group">
                                <label>Target Repository</label>
                                <select
                                    value={newTask.repositoryUrl}
                                    onChange={(e) => handleRepositoryChange(e.target.value)}
                                >
                                    <option value="">Current Repository (um-agent-orchestration)</option>
                                    {repositories.map(repo => (
                                        <option key={repo.name} value={repo.url}>
                                            {repo.name} {repo.has_specs ? 'ðŸ“‹' : ''} ({repo.current_branch})
                                        </option>
                                    ))}
                                </select>
                            </div>
                            <div className="form-group">
                                <label>Base Branch (optional)</label>
                                <select
                                    value={newTask.baseBranch}
                                    onChange={(e) => setNewTask({...newTask, baseBranch: e.target.value})}
                                >
                                    <option value="">Default (main/master)</option>
                                    {availableBranches.map(branch => (
                                        <option key={branch} value={branch}>
                                            {branch}
                                        </option>
                                    ))}
                                </select>
                            </div>
                            <div className="form-group">
                                <label>Detailed Description</label>
                                <textarea
                                    value={newTask.description}
                                    onChange={(e) => setNewTask({...newTask, description: e.target.value})}
                                    placeholder="Detailed requirements and acceptance criteria"
                                    required
                                />
                            </div>
                            <div className="form-group">
                                <label>
                                    <input
                                        type="checkbox"
                                        checked={newTask.fullAccess}
                                        onChange={(e) => setNewTask({...newTask, fullAccess: e.target.checked})}
                                        style={{marginRight: '8px'}}
                                    />
                                    Enable Full Access Mode (--dangerously-skip-permissions)
                                </label>
                            </div>
                            {submitError && (
                                <div style={{
                                    background: '#ef4444',
                                    color: 'white',
                                    padding: '12px',
                                    borderRadius: '6px',
                                    marginBottom: '16px',
                                    fontSize: '0.875rem'
                                }}>
                                    âŒ {submitError}
                                </div>
                            )}
                            {submitSuccess && (
                                <div style={{
                                    background: '#10b981',
                                    color: 'white',
                                    padding: '12px',
                                    borderRadius: '6px',
                                    marginBottom: '16px',
                                    fontSize: '0.875rem'
                                }}>
                                    âœ… Task submitted successfully!
                                </div>
                            )}
                            <button 
                                type="submit" 
                                className="submit-button"
                                disabled={isSubmitting}
                                style={{
                                    opacity: isSubmitting ? 0.6 : 1,
                                    cursor: isSubmitting ? 'not-allowed' : 'pointer'
                                }}
                            >
                                {isSubmitting ? 'â³ Submitting...' : 'ðŸš€ Submit Task'}
                            </button>
                        </form>
                    </div>

                    {repositorySpecs.length > 0 && (
                        <div className="specs-section">
                            <h2 className="section-title">ðŸ“‹ Project Specs & Planning ({repositorySpecs.length} specs)</h2>
                            <div className="specs-grid">
                                <div>
                                    <h3 style={{color: '#f1f5f9', marginBottom: '12px', fontSize: '1rem'}}>Available Specs</h3>
                                    <div className="spec-list">
                                        {repositorySpecs.map(spec => (
                                            <div 
                                                key={spec.filename}
                                                className={`spec-item ${selectedSpec?.filename === spec.filename ? 'selected' : ''}`}
                                                onClick={() => handleSpecSelect(spec)}
                                            >
                                                <div className="spec-title">{spec.title}</div>
                                                <div className="spec-summary">{spec.summary}</div>
                                                <div style={{fontSize: '0.75rem', color: '#64748b', marginTop: '4px'}}>
                                                    {spec.filename} â€¢ {(spec.size/1024).toFixed(1)}kb
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                                <div>
                                    <div style={{display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '12px'}}>
                                        <h3 style={{color: '#f1f5f9', fontSize: '1rem'}}>
                                            {selectedSpec ? `ðŸ“„ ${selectedSpec.title}` : 'Select a spec to review'}
                                        </h3>
                                        {selectedSpec && (
                                            <div style={{display: 'flex', gap: '4px'}}>
                                                <div 
                                                    className={`spec-tab ${specViewMode === 'summary' ? 'active' : ''}`}
                                                    onClick={() => setSpecViewMode('summary')}
                                                >
                                                    ðŸ“‹ Summary
                                                </div>
                                                <div 
                                                    className={`spec-tab ${specViewMode === 'phases' ? 'active' : ''}`}
                                                    onClick={() => setSpecViewMode('phases')}
                                                >
                                                    ðŸŽ¯ Phases
                                                </div>
                                                <div 
                                                    className={`spec-tab ${specViewMode === 'content' ? 'active' : ''}`}
                                                    onClick={() => setSpecViewMode('content')}
                                                >
                                                    ðŸ“– Full
                                                </div>
                                            </div>
                                        )}
                                    </div>
                                    
                                    {selectedSpec ? (
                                        <div>
                                            {specViewMode === 'summary' && (
                                                <div>
                                                    <div className="spec-meta">
                                                        <span>ðŸ“Š {selectedSpec.key_sections} sections</span>
                                                        <span>ðŸ“ {(selectedSpec.size/1024).toFixed(1)}kb</span>
                                                        <span>ðŸŽ¯ {selectedSpec.responsibilities?.length || 0} responsibilities</span>
                                                    </div>
                                                    
                                                    <div style={{color: '#e2e8f0', marginBottom: '16px', lineHeight: '1.6'}}>
                                                        {selectedSpec.summary}
                                                    </div>
                                                    
                                                    {selectedSpec.responsibilities && selectedSpec.responsibilities.length > 0 && (
                                                        <div className="responsibilities-list">
                                                            <h4 style={{color: '#f59e0b', fontSize: '0.875rem', marginBottom: '8px'}}>Key Responsibilities:</h4>
                                                            {selectedSpec.responsibilities.map((resp, idx) => (
                                                                <div key={idx} className="responsibility-item">â€¢ {resp}</div>
                                                            ))}
                                                        </div>
                                                    )}
                                                </div>
                                            )}
                                            
                                            {specViewMode === 'phases' && selectedSpec.phases && (
                                                <div className="spec-phases">
                                                    <h4 style={{color: '#10b981', fontSize: '0.875rem', marginBottom: '12px'}}>Project Phases:</h4>
                                                    {selectedSpec.phases.map((phase, idx) => (
                                                        <div key={idx} className="phase-item">
                                                            <div className="phase-title">{phase.title}</div>
                                                            <div className="phase-details">{phase.details}</div>
                                                        </div>
                                                    ))}
                                                </div>
                                            )}
                                            
                                            {specViewMode === 'content' && (
                                                <div className="spec-content">
                                                    {selectedSpec.content}
                                                </div>
                                            )}
                                        </div>
                                    ) : (
                                        <div style={{color: '#64748b', fontStyle: 'italic', padding: '20px', textAlign: 'center'}}>
                                            Click on a spec file to review its contents and use it for task planning
                                        </div>
                                    )}
                                </div>
                            </div>
                        </div>
                    )}

                    <div className="tasks-section">
                        <div className="section-card">
                            <h2 className="section-title">Active Tasks ({runningTasks.length})</h2>
                            {runningTasks.map(task => (
                                <div key={task.id} className={`task-item ${task.status}`}>
                                    <div className="task-header">
                                        <div className="task-title">{task.title}</div>
                                        <div className={`task-status status-${task.status}`}>
                                            {task.status}
                                        </div>
                                    </div>
                                    <div className="task-meta">
                                        Role: {task.role} â€¢ Branch: {task.branch}
                                    </div>
                                    <div className="task-description">
                                        {task.description}
                                    </div>
                                    {task.status === 'running' && (
                                        <div className={`task-progress ${task.status}`}>
                                            <div 
                                                className="task-progress-bar"
                                                style={{width: `${task.progress || 50}%`}}
                                            ></div>
                                        </div>
                                    )}
                                    {task.status === 'queued' && (
                                        <div style={{fontSize: '0.75rem', color: '#f59e0b', marginTop: '8px'}}>
                                            â±ï¸ Waiting in queue...
                                        </div>
                                    )}
                                </div>
                            ))}
                        </div>

                        <div className="section-card">
                            <h2 className="section-title">Recent Completed ({completedTasks.length})</h2>
                            {completedTasks.slice(-5).map(task => (
                                <div key={task.id} className={`task-item ${task.status}`}>
                                    <div className="task-header">
                                        <div className="task-title">{task.title}</div>
                                        <div className={`task-status status-${task.status}`}>
                                            {task.status}
                                        </div>
                                    </div>
                                    <div className="task-meta">
                                        Role: {task.role} â€¢ Branch: {task.branch}
                                    </div>
                                    <div className="task-description">
                                        {task.description}
                                    </div>
                                    {task.error && (
                                        <div style={{color: '#ef4444', fontSize: '0.75rem', marginTop: '8px'}}>
                                            Error: {task.error}
                                        </div>
                                    )}
                                </div>
                            ))}
                        </div>
                    </div>

                    <div className="tasks-section">
                        <div className="section-card">
                            <h2 className="section-title">Merge Queue ({mergeQueue.queue_length})</h2>
                            {mergeQueue.active_merge && (
                                <div className="task-item running" style={{marginBottom: '16px'}}>
                                    <div className="task-header">
                                        <div className="task-title">ðŸ”„ Currently Merging</div>
                                        <div className="task-status status-running">merging</div>
                                    </div>
                                    <div className="task-meta">PR: {mergeQueue.active_merge}</div>
                                </div>
                            )}
                            {mergeQueue.queue.map(pr => (
                                <div key={pr.pr_id} className={`task-item ${pr.status === 'conflict' ? 'failed' : 'queued'}`}>
                                    <div className="task-header">
                                        <div className="task-title">PR-{pr.pr_id}</div>
                                        <div className={`task-status ${pr.status === 'conflict' ? 'status-failed' : 'status-queued'}`}>
                                            {pr.status}
                                        </div>
                                    </div>
                                    <div className="task-meta">
                                        Priority: {pr.priority} â€¢ {pr.branch}
                                    </div>
                                    {pr.conflicts.length > 0 && (
                                        <div style={{color: '#ef4444', fontSize: '0.75rem', marginTop: '8px'}}>
                                            Conflicts: {pr.conflicts.join(', ')}
                                        </div>
                                    )}
                                </div>
                            ))}
                        </div>

                        <div className="section-card">
                            <h2 className="section-title">Agent Status ({agents.length} agents)</h2>
                            <div className="agent-grid">
                                {agents.map(agent => (
                                    <div key={agent.name} className="agent-card">
                                        <div className="agent-header">
                                            <div className="agent-name">{agent.name}</div>
                                            <div className={`agent-status status-${agent.status}`}></div>
                                        </div>
                                        <div style={{fontSize: '0.875rem', color: '#94a3b8', marginBottom: '8px'}}>
                                            Provider: {agent.provider}
                                        </div>
                                        {agent.currentTask && (
                                            <div style={{fontSize: '0.875rem', color: '#3b82f6', marginBottom: '8px'}}>
                                                Working on: {agent.currentTask}
                                            </div>
                                        )}
                                        <ul className="provider-list">
                                            {agent.capabilities.map(cap => (
                                                <li key={cap}>â€¢ {cap}</li>
                                            ))}
                                        </ul>
                                    </div>
                                ))}
                            </div>
                        </div>
                    </div>

                    <button className="refresh-button" onClick={refreshData} title="Refresh Dashboard">
                        â†»
                    </button>

                    {/* CLI Interface Section */}
                    <div className="cli-section" style={{marginTop: '24px'}}>
                        <h2 className="section-title">ðŸ’» CLI Interface</h2>
                        <div className="cli-controls" style={{marginBottom: '20px'}}>
                            <div className="cli-info" style={{marginBottom: '12px'}}>
                                <p style={{color: '#94a3b8', margin: 0, fontSize: '0.875rem'}}>
                                    Launch real {selectedModel} CLI sessions â€¢ {modelMode === 'cli' ? 'Uses local CLI tools' : 'Direct API integration'}
                                </p>
                                <p style={{color: '#64748b', margin: '4px 0 0 0', fontSize: '0.75rem'}}>
                                    Sessions run actual commands and maintain persistent state
                                </p>
                            </div>
                            <div style={{display: 'flex', gap: '8px', alignItems: 'center'}}>
                                <button 
                                    className="cli-new-session-btn"
                                    onClick={() => createCliSession(selectedModel, false)}
                                    title="Start a standard CLI session"
                                >
                                    + New Session
                                </button>
                                <button 
                                    className="cli-new-session-btn" 
                                    style={{background: '#8b5cf6'}}
                                    onClick={() => createCliSession(selectedModel, true)}
                                    title="Start with full file system access (danger mode)"
                                >
                                    ðŸ”“ Full Access
                                </button>
                            </div>
                        </div>
                                {/* Real CLI Terminal Interface */}
                                <div className="cli-terminal-container">
                                    {/* Session Tabs */}
                                    {Object.keys(cliSessions).length > 0 && (
                                        <div className="cli-session-tabs">
                                            {Object.values(cliSessions).map(session => (
                                                <div
                                                    key={session.id}
                                                    className={`cli-session-tab ${activeSessionId === session.id ? 'active' : ''}`}
                                                    onClick={() => setActiveSessionId(session.id)}
                                                >
                                                    <span className={`cli-status-dot status-${session.state}`}></span>
                                                    {session.cli_tool}
                                                    {session.fullAccess && ' ðŸ”“'}
                                                    <button
                                                        className="cli-session-close"
                                                        onClick={(e) => {
                                                            e.stopPropagation();
                                                            terminateCliSession(session.id);
                                                        }}
                                                    >
                                                        âœ•
                                                    </button>
                                                </div>
                                            ))}
                                        </div>
                                    )}
                                    
                                    {activeSessionId && cliSessions[activeSessionId] ? (
                                        <React.Fragment>
                                            {/* Terminal Header */}
                                            <div className="cli-terminal-header">
                                                <div className="terminal-title">
                                                    ðŸŽ¯ {cliSessions[activeSessionId].cli_tool.toUpperCase()} CLI Session
                                                    {cliSessions[activeSessionId].fullAccess && ' â€¢ FULL ACCESS'}
                                                </div>
                                                <div className="cli-status-indicators">
                                                    <div className={`cli-status-indicator status-${cliSessions[activeSessionId].state}`}>
                                                        <div className="cli-status-dot"></div>
                                                        {cliSessions[activeSessionId].state.replace('_', ' ')}
                                                    </div>
                                                    <div className={`cli-connection-status connection-${cliSessions[activeSessionId].connectionStatus}`}>
                                                        {cliSessions[activeSessionId].connectionStatus}
                                                    </div>
                                                    {cliSessions[activeSessionId].pid && (
                                                        <div className="cli-status-indicator">
                                                            PID: {cliSessions[activeSessionId].pid}
                                                        </div>
                                                    )}
                                                </div>
                                            </div>
                                            
                                            {/* Terminal Output */}
                                            <div className="cli-terminal-output">
                                                {cliSessions[activeSessionId].authRequired && (
                                                    <div className="cli-auth-prompt" style={{
                                                        background: '#fef3c7',
                                                        color: '#92400e',
                                                        padding: '12px',
                                                        borderRadius: '6px',
                                                        marginBottom: '12px',
                                                        border: '1px solid #fbbf24'
                                                    }}>
                                                        <div style={{fontWeight: 'bold', marginBottom: '4px'}}>
                                                            ðŸ” Authentication Required
                                                        </div>
                                                        <div style={{fontSize: '0.875rem'}}>
                                                            {cliSessions[activeSessionId].authPrompt}
                                                        </div>
                                                        <div style={{fontSize: '0.75rem', marginTop: '8px', color: '#78350f'}}>
                                                            ðŸ’¡ Enter your credentials in the input field below. Input is hidden for security.
                                                        </div>
                                                    </div>
                                                )}
                                                
                                                <div className="cli-process-status">
                                                    <span className={`cli-status-dot status-${cliSessions[activeSessionId].state}`}></span>
                                                    {cliSessions[activeSessionId].state.replace('_', ' ')}
                                                </div>
                                                
                                                {cliSessions[activeSessionId].output.map((entry, idx) => (
                                                    <div key={idx} className={`cli-output-line cli-output-${entry.type}`}>
                                                        {entry.type === 'command' && (
                                                            <span style={{color: '#10b981'}}>
                                                                {cliSessions[activeSessionId].cli_tool}$ 
                                                            </span>
                                                        )}
                                                        {entry.content}
                                                    </div>
                                                ))}
                                            </div>
                                            
                                            {/* Terminal Input */}
                                            <div className="cli-terminal-input-container">
                                                <span className="terminal-prompt" style={{color: '#10b981'}}>
                                                    {cliSessions[activeSessionId].cli_tool}$ 
                                                </span>
                                                <input
                                                    type={cliSessions[activeSessionId].authRequired ? "password" : "text"}
                                                    className="cli-terminal-input"
                                                    value={cliSessions[activeSessionId].input}
                                                    onChange={(e) => setCliSessions(prev => ({
                                                        ...prev,
                                                        [activeSessionId]: {
                                                            ...prev[activeSessionId],
                                                            input: e.target.value
                                                        }
                                                    }))}
                                                    onKeyDown={(e) => {
                                                        const handleCliKeyboard = (e) => {
                                                            const session = cliSessions[activeSessionId];
                                                            const input = session.input;
                                                            
                                                            if (e.key === 'Enter') {
                                                                e.preventDefault();
                                                                
                                                                // For interactive prompts (like authentication), allow empty input  
                                                                if (session.authRequired || input.trim()) {
                                                                    sendCliInput(activeSessionId, input);
                                                                    
                                                                    // Clear input after sending
                                                                    setCliSessions(prev => ({
                                                                        ...prev,
                                                                        [activeSessionId]: {
                                                                            ...prev[activeSessionId],
                                                                            input: ''
                                                                        }
                                                                    }));
                                                                }
                                                            } else if (e.key === 'Escape') {
                                                                e.preventDefault();
                                                                // Send escape character to CLI
                                                                sendCliInput(activeSessionId, '\x1b', 'command');
                                                            } else if (e.key === 'Tab') {
                                                                e.preventDefault();
                                                                // Send tab character for completion
                                                                sendCliInput(activeSessionId, '\t', 'command');
                                                            } else if (e.key === 'ArrowUp') {
                                                                e.preventDefault();
                                                                // Send up arrow for history navigation
                                                                sendCliInput(activeSessionId, '\x1b[A', 'command');
                                                            } else if (e.key === 'ArrowDown') {
                                                                e.preventDefault();
                                                                // Send down arrow for history navigation
                                                                sendCliInput(activeSessionId, '\x1b[B', 'command');
                                                            } else if (e.key === 'ArrowLeft') {
                                                                // Allow normal cursor movement in input field
                                                                return;
                                                            } else if (e.key === 'ArrowRight') {
                                                                // Allow normal cursor movement in input field
                                                                return;
                                                            } else if (e.ctrlKey && e.key === 'c') {
                                                                e.preventDefault();
                                                                // Send interrupt signal (Ctrl+C)
                                                                sendCliInput(activeSessionId, '\x03', 'command');
                                                            } else if (e.ctrlKey && e.key === 'd') {
                                                                e.preventDefault();
                                                                // Send EOF signal (Ctrl+D)
                                                                sendCliInput(activeSessionId, '\x04', 'command');
                                                            } else if (e.ctrlKey && e.key === 'z') {
                                                                e.preventDefault();
                                                                // Send suspend signal (Ctrl+Z)
                                                                sendCliInput(activeSessionId, '\x1a', 'command');
                                                            }
                                                        };
                                                        
                                                        handleCliKeyboard(e);
                                                    }}
                                                    placeholder={cliSessions[activeSessionId].authRequired ? 
                                                        "Enter authentication details..." : 
                                                        `Type commands for ${cliSessions[activeSessionId].cli_tool}...`}
                                                    disabled={cliSessions[activeSessionId].connectionStatus !== 'connected'}
                                                />
                                                <div className="cli-input-actions">
                                                    <button
                                                        className="cli-input-action"
                                                        onClick={() => {
                                                            // Send cancel/interrupt message using the correct format
                                                            sendCliInput(activeSessionId, '\x03', 'cancel');
                                                        }}
                                                        disabled={cliSessions[activeSessionId].connectionStatus !== 'connected'}
                                                    >
                                                        Ctrl+C
                                                    </button>
                                                </div>
                                            </div>
                                        </React.Fragment>
                                    ) : (
                                        <div style={{
                                            display: 'flex',
                                            alignItems: 'center',
                                            justifyContent: 'center',
                                            height: '400px',
                                            color: '#64748b',
                                            textAlign: 'center',
                                            background: '#0f1419',
                                            border: '1px solid #334155',
                                            borderRadius: '8px'
                                        }}>
                                            <div>
                                                <div style={{fontSize: '3rem', marginBottom: '16px'}}>ðŸ’»</div>
                                                <div style={{fontSize: '1.25rem', marginBottom: '8px', color: '#94a3b8'}}>
                                                    No CLI sessions active
                                                </div>
                                                <div style={{fontSize: '0.875rem', marginBottom: '16px', maxWidth: '300px'}}>
                                                    Start a session to interact directly with {selectedModel} CLI tools or API
                                                </div>
                                                <div style={{
                                                    background: '#1e293b', 
                                                    padding: '12px', 
                                                    borderRadius: '6px', 
                                                    fontSize: '0.75rem',
                                                    textAlign: 'left',
                                                    maxWidth: '350px',
                                                    margin: '0 auto'
                                                }}>
                                                    <div style={{color: '#10b981', marginBottom: '6px'}}>ðŸ’¡ Session Types:</div>
                                                    <div>â€¢ <strong>New Session:</strong> Standard access, safe for exploration</div>
                                                    <div>â€¢ <strong>Full Access:</strong> Unrestricted access (use with caution)</div>
                                                </div>
                                            </div>
                                        </div>
                                    )}
                                </div>
                    </div>
                </div>
            );
        }

        class ErrorBoundary extends React.Component {
            constructor(props) {
                super(props);
                this.state = { hasError: false, error: null };
            }
            static getDerivedStateFromError(error) {
                return { hasError: true, error };
            }
            componentDidCatch(error, info) {
                console.error('Dashboard ErrorBoundary caught:', error, info);
            }
            render() {
                if (this.state.hasError) {
                    return React.createElement('div', { style: { padding: '16px', color: '#ef4444' } },
                        'Something went wrong in the dashboard. Check console for details.'
                    );
                }
                return this.props.children;
            }
        }

        const root = ReactDOM.createRoot(document.getElementById('dashboard-root'));
        root.render(
            <ErrorBoundary>
                <Dashboard />
            </ErrorBoundary>
        );
    </script>
</body>
</html>
